<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Flujo estilo oscuro</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    /* Estilos globales */
    body {
      margin: 0;
      padding: 0;
      background-color: #181818; /* Fondo oscuro general */
      overflow-x: scroll;       /* Scroll horizontal si el contenido es ancho */
      color: #fff;             /* Texto claro */
      font-family: sans-serif;
    }
    /* Contenedor del SVG */
    #tree-container {
      width: 1200px; /* Ajusta según necesites */
      height: 600px;
      margin: 0 auto;
      position: relative;
    }
    /* El SVG ocupará el tamaño indicado (puedes ajustar) */
    svg {
      width: 1200px;
      height: 600px;
      background-color: #181818; /* Mismo fondo que body */
    }
    /* Estilo de las líneas que unen los nodos */
    .link {
      fill: none;
      stroke: #6c757d;  /* Gris medio */
      stroke-width: 2px;
    }
    /* Grupo de cada nodo */
    .node {
      cursor: pointer;
    }
    /* El rectángulo del nodo (fondo oscuro, bordes redondeados) */
    .node-rect {
      fill: #2d2d2d;
      stroke: #2d2d2d;
      rx: 6;  /* esquinas redondeadas */
      ry: 6;
    }
    /* Texto principal dentro del nodo */
    .node-name {
      fill: #f8f9fa; /* texto claro */
      font-size: 14px;
      font-weight: 600;
    }
    /* Texto para la duración (o subtítulo) */
    .node-duration {
      fill: #9ca3af; /* gris claro */
      font-size: 12px;
    }
    /* Círculo que aparece a la izquierda del nombre */
    .node-circle {
      fill: #f1c40f; /* color “amarillo/dorado” */
    }
  </style>
</head>
<body>

<div id="tree-container">
  <svg id="tree-svg"></svg>
</div>

<script>
  // Ejemplo de datos (puedes expandirlo o adaptarlo)
  const data = {
    name: "build",
    duration: "21s",
    children: [
      {
        name: "report-build-status",
        duration: "10s"
      },
      {
        name: "deploy",
        duration: "30s"
      }
    ]
  };

  // Dimensiones generales
  const width = 1200;
  const height = 600;
  const margin = { top: 50, right: 50, bottom: 50, left: 50 };

  // Seleccionamos y configuramos el SVG
  const svg = d3.select("#tree-svg")
                .attr("viewBox", `0 0 ${width} ${height}`);

  // Creamos la raíz jerárquica
  const root = d3.hierarchy(data);

  // Layout de árbol horizontal
  // size([alto, ancho]) => invertimos para que sea horizontal
  const treeLayout = d3.tree()
                       .size([height - margin.top - margin.bottom, width - margin.left - margin.right]);

  // Ejecutamos el layout sobre la raíz
  treeLayout(root);

  // Generador de enlaces horizontales
  const linkGenerator = d3.linkHorizontal()
                          .x(d => d.y + margin.left)
                          .y(d => d.x + margin.top);

  // Dibujamos los enlaces
  svg.selectAll("path.link")
     .data(root.links())
     .enter()
     .append("path")
     .attr("class", "link")
     .attr("d", linkGenerator);

  // Creamos un grupo <g> para cada nodo
  const nodeGroup = svg.selectAll("g.node")
    .data(root.descendants())
    .enter()
    .append("g")
    .attr("class", "node")
    .attr("transform", d => `translate(${d.y + margin.left},${d.x + margin.top})`);

  // Dimensiones del rectángulo de cada nodo
  const nodeWidth = 120;
  const nodeHeight = 40;

  // Fondo del nodo (rectángulo oscuro con esquinas redondeadas)
  nodeGroup.append("rect")
    .attr("class", "node-rect")
    .attr("width", nodeWidth)
    .attr("height", nodeHeight)
    .attr("x", -nodeWidth / 2)  // Para centrar el rect en la posición del nodo
    .attr("y", -nodeHeight / 2);

  // Círculo decorativo a la izquierda (puedes ajustarlo)
  nodeGroup.append("circle")
    .attr("class", "node-circle")
    .attr("cx", -nodeWidth / 2 + 12)   // Un poco a la izquierda
    .attr("cy", 0)
    .attr("r", 6);

  // Nombre principal (texto) en el centro-izquierda
  nodeGroup.append("text")
    .attr("class", "node-name")
    .attr("x", -nodeWidth / 2 + 28) // un poco a la derecha del círculo
    .attr("y", -4)                 // ligeramente arriba del centro vertical
    .text(d => d.data.name);

  // Duración (subtítulo) en la parte de abajo (más claro)
  nodeGroup.append("text")
    .attr("class", "node-duration")
    .attr("x", -nodeWidth / 2 + 28)
    .attr("y", 10)
    .text(d => d.data.duration ? d.data.duration : "");

</script>

</body>
</html>
